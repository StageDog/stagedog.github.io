# 附.自查问题和如何提问

{{ prolog }}

- {ref}`MVU_常见问题自查`
- {ref}`MVU_提问`

(MVU_常见问题自查)=

## 常见问题自查

新开聊天, 发送任意消息, 然后

- 打开{menuselection}`聊天框左下角魔棒-变量管理器-消息楼层`;
- 打开{menuselection}`聊天框左下角魔棒-日志查看器`;
- 点击楼层右上角的小铅笔, 查看 AI 实际回复的内容.

基于这三类信息, 开始**从上到下**看常见问题中有没有你遇到的问题, 并尝试自行解决. \
如果解决不了, 请在帖子向我们{ref}`MVU_提问`.

- {ref}`MVU_常见问题自查_stat_data`
- {ref}`MVU_常见问题自查_变量结构注册`
- {ref}`MVU_常见问题自查_变量结构初始化失败`
- {ref}`MVU_常见问题自查_没有updatevariable`
- {ref}`MVU_常见问题自查_出现updatevariable但没更新`
- {ref}`MVU_常见问题自查_发生变量更新错误`
- {ref}`MVU_常见问题自查_状态栏`
- {ref}`MVU_常见问题自查_重复更新`

(MVU_常见问题自查_stat_data)=

### 变量管理器中没有 `stat_data`

请检查以下内容:

- 确认给角色卡导入了 MVU 脚本以及 AI 生成出来的变量结构脚本;
- 确认有在世界书设置 `[initvar]变量初始化勿开` 条目, 且处于关闭状态;
- 确认酒馆插头选择的是{menuselection}`聊天补全`.

(MVU_常见问题自查_变量结构注册)=

### 日志查看器中没有 `变量结构注册成功`

说明你的变量结构脚本出现了错误:

- 请从日志查看器复制所有`【脚本|变量结构】`开头的日志, 将它发给 AI 来让它重新生成变量结构脚本;
- 没有`【脚本|变量结构】`开头的日志就直接告诉 AI 出错了需要修改.

另外要记住, **不要用 `{{user}}` 等宏作为变量名**, 用宏作为变量名会非常麻烦, 换成`主角`等无需宏的变量名!

(MVU_常见问题自查_变量结构初始化失败)=

### 日志查看器中出现红色的 `【脚本|变量结构】变量初始化失败`

说明你的变量初始值 initvar 出现了错误.

- 请从日志查看器复制所有`【脚本|变量结构】`开头的日志, 将它发给 AI 来让它重新生成变量初始值 initvar 条目;
- 没有`【脚本|变量结构】`开头的日志就直接告诉 AI 出错了需要修改.

(MVU_常见问题自查_没有updatevariable)=

### AI 回复中没有 `<UpdateVariable>`

与下面一个问题解决思路相同:

(MVU_常见问题自查_出现updatevariable但没更新)=

### AI 回复中出现 `<UpdateVariable>` 但变量管理器没更新

首先排查有没有上面那些问题.

如果没有, 与下面一个问题解决思路相同:

(MVU_常见问题自查_发生变量更新错误)=

### 日志查看器中出现黄色的 `【脚本|变量结构】发生变量更新错误`

注意是变量结构脚本发出的 `【脚本|变量结构】发生变量更新错误`, 而不是 `【脚本|MVU】发生变量更新错误`. \
(如果是`【脚本|MVU】发生变量更新错误`, 说明你的变量结构脚本出现了问题, 不能正常使用.)

首先, 确认你的世界书里已经添加了变量提示词且是蓝灯 ({doc}`除非你知道绿灯等有什么用 </青空莉/工具经验/酒馆如何处理世界书/激活/index>`). 如果没有, 请按照{doc}`变量提示词 </络络/教程/手写mvu变量卡/变量提示词/index>`添加:

- `[mvu_update]变量更新规则`: 一般由写卡助手根据你发给它的变量结构生成, 检查一下其中每个变量的 `check` 是否符合你的需求;
- `变量列表`: 一般与[`变量列表`](https://github.com/StageDog/tavern_helper_template/blob/main/初始模板/角色卡/新建为src文件夹中的文件夹/世界书/变量/变量列表.txt)相同, 除非你有自己设计它的需求;
- `[mvu_update]变量输出格式`: 一般与[`[mvu_update]变量输出格式`](https://github.com/StageDog/tavern_helper_template/blob/main/初始模板/角色卡/新建为src文件夹中的文件夹/世界书/变量/变量输出格式.yaml)相同, 除非你有自己设计它的需求;

然后, 你需要清楚你现在是在测试、游玩角色卡, 而不是制作角色卡——你需要启用提示词模板和酒馆助手宏:

- 确认{menuselection}`提示词模板`插件处于开启状态;
- 确认{menuselection}`酒馆助手-主界面-禁用酒馆助手宏`处于禁用状态;

最后, 你需要查询自己的提示词情况:

- 打开{menuselection}`聊天框左下角魔棒-提示词查看器`, 你现在有多少 token? 如果很多, 你确定这对于刚开局的角色卡是正常的吗?
- 你在角色卡里塞了多少条目, 有没有别的条目占用了大量 token?
- 你除了角色卡外有没有在全局开启其他世界书?
- 提示词查看器内能否搜索到你认为应该发送出去的某些提示词?
  - 比如, 你能搜索到`变量输出格式:`吗?
  - 注意, 如果你的{menuselection}`MVU变量框架 --> 变量更新方式`是{menuselection}`额外模型解析`, 那你需要挂着提示词查看器, 触发额外模型解析, 这样查看器里才是额外模型解析的提示词, 里面应该能搜索到`变量输出格式:`.
- 你现在使用的什么模型/预设, 切换模型/预设能正常吗?

如果依旧有问题, 说明 AI 犯蠢了, 没有按照变量提示词输出变量更新命令.

不过, AI 犯的某些蠢我们是可以通过调整变量结构脚本或{doc}`额外添加脚本 </络络/教程/手写mvu变量卡/脚本控制变量/index>`来解决的.

比如你的角色卡支持中途新增角色, 可你又给每个角色设计了几十个变量, 那么 AI 在为新角色设置变量时很可能遗漏某些变量, 从而无法成功新增角色.

为此, 你可以要求 AI 在变量结构脚本中为角色的变量设置默认值 `待初始化` (或你想要的其他默认值). 这样一来, AI 哪怕遗漏角色的某些变量, 整个角色依旧能够新增到角色列表中, 而 AI 可以在后续回复中初始化这些 `待初始化` 变量.

(MVU_常见问题自查_状态栏)=

### 变量管理器里变量正常更新了, 但状态栏没更新

注意是**变量管理器里变量正常更新了, 但状态栏没更新**. 如果变量管理器里都没正常更新, 那你漏了上面的自查!

检查一下你有没有忘记在 html 上下添加一行 `` ``` ``. 如果有添加 `` ``` `` 但状态栏上的数据还是不对……没啥好说的, 重新拷打 AI 做状态栏.

- 电脑用{doc}`/青空莉/工具经验/实时编写前端界面或脚本/index`让 AI 能自己看酒馆网页、实时修改, 成功率很高的;
- 手机的话……不要让 AI 修改原本就有错的状态栏, 会错上加错; 最好是让 AI 重新生成状态栏.

(MVU_常见问题自查_重复更新)=

### 明明上一次回复里变量已经更新过了, 但这一次又重复更新

- 因为 AI 只知道变量最新值, 不知道过去的变量更新情况: {ref}`修改正则, 让AI知道以前的变量更新情况 <MVU_让AI知道以前的变量更新情况>`
- 因为 AI 不知道玩家通过前端界面修改了变量: {ref}`创建日志变量, 记录玩家在前端界面的操作 <MVU_记录玩家在前端界面的操作>`

(MVU_提问)=

## 提问

如果按照教程编写时遇到任何问题, 欢迎前往帖子 ([类脑](https://discord.com/channels/1134557553011998840/1400321862235328552/1400321862235328552)/[旅程](https://discord.com/channels/1291925535324110879/1400321714298294272/1400321714298294272)) 进行提问!

### 提问须知

- 在提问之前, 请你先阅读上面的{ref}`MVU_常见问题自查`, 或**重新阅读一下教程开头一直到你出问题的地方**, 确保你的操作没有出现问题! **帖子里大多数提问都是因此造成的.**
- 在提问时, 你可能会需要截图. **务必全屏截图而不是截取某个部分!** 你就是不知道哪里出了问题才来提问的, 如果你只截取你认为出问题的部分, 那要是其实是别的地方出问题该怎么办? 只截图某个部分只会让问题更难解决!!!

### 应该提供什么信息

如果你重新阅读教程后仍然无法解决问题, 请在帖子里向我们提问. 提问时尽量携带以下信息:

- **告诉我们你已经进行过了{ref}`MVU_常见问题自查`!**
- 告诉我们你已经尝试关闭过不相关的插件、全局脚本、全局正则, 来排除它们的影响;
- 打开{menuselection}`聊天框左下角魔棒-提示词查看器`并完整截图;
- 打开{menuselection}`聊天框左下角魔棒-变量管理器-消息楼层`并完整截图;
- 电脑上, {menuselection}`f12 --> console (控制台)` 截图所有红色报错;
- 手机上, 打开{menuselection}`聊天框左下角魔棒-日志查看器`截图所有红色报错;

然后, 直接发送出问题的**角色卡**、**聊天消息**, 告诉我们**进行什么操作能够再次得到那个错误**.
